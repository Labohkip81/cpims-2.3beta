{% extends 'base.html' %}

{% load staticfiles %}
{% load choice_fields_filter %}
{% block page_title %} Data Clean Up{% endblock %}

{% block style_code %}
<link href="{% static 'css/bootstrap-table.min.css' %}" rel="stylesheet" />
{% endblock %}

{% block primary %}
<h1 class="page-header">Data Clean Up <small>Age Based</small></h1>
{% if error %}
<div class='alert alert-warning'>{{ error }}</div>
{% endif %}
<form class='form' action="{% url 'data_cleanup' %}" method="POST">
    {% csrf_token %}
    <div class='row'>
      <div class='col-lg-6'>
            Age Operator
            <select name='operator' class="form-control" id='operator'>
                    <option value="0">Select Operator</option>
                    <option value='='>Equals</option>
                    <option value='>'>Greater Than</option>
                    <option value='<'>Less Than</option>
                    <option value='-'>Between</option>
                </select>
            Age
            <input type='text' name='age' class="form-control" id='age'>

            School Level
            <select name='school_level' class="form-control" id='school_level'>
                <option value="0">Select Shool Level</option>
                <option value='SLSE'>Secondary</option>
                <option value='SLPR'>Primary</option>
                <option value='SLNS'>NO School</option>
            </select>
    </div>
                    <div class='col-lg-6'>
        HIV Status
        <select name='hiv_status' class="form-control" id='hiv_status'>
          <option value="0">Select HIV Status</option>
          <option value='HSTR'>HSTR</option>
          <option value='HSKN'>HSKN</option>
          <option value='HSTP'>HSTP</option>
          <option value='XXXX'>XXXX</option>
          <option value='HSTN'>HSTN</option>
          <option value='HSRT'>HSRT</option>
        </select>
        ART Status
        <select name='art_status' class="form-control" id='art_status'>
            <option value="0">Select Art Status</option>
            <option value='ART'>ART</option>
            <option value='ARAR'>ARAR</option>
            <option value='ARV'>ARV</option>
          </select>
    </div>
  </div>
</br>
<div class='pull-right'>
<button type='submit' class='btn btn-primary'>Filter</button>
<a class='btn btn-success' onclick=export_data()><i class="fa fa-download"></i> &nbsp Export</a>
</div>
</form>
</br>
</br>
{% if data %}
<table class="table" id='age-data-table'>
<thead>
    <tr>
      <th>Name</th>
      <th>Age</th>
      <th>School Level</th>
      <th>HIV Status</th>
      <th>ART Status</th>
    </tr>
  </thead>
  <tbody>
      {% for obj in data %}
    <tr>
      <td>{{ obj.first_name }} {{ obj.other_names }} </td>
      <td>{{ obj.age }} </td>
      <td>{{ obj.school_level |format_choice_fields }}</td>
      <td>{{ obj.hiv_status |format_choice_fields }}</td>
      <td>{{ obj.art_status | format_choice_fields}}</td>
    </tr>
    {% endfor %}
    
  </tbody>
</table>
{% if is_paginated %}
        <div class="pagination">
            <span class="page-links">
                {% if page_obj.has_previous %}
                    <a href="?page={{ page_obj.previous_page_number }}">previous</a>
                {% endif %}
                <span class="page-current">
                    Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                </span>
                {% if page_obj.has_next %}
                    <a href="?page={{ page_obj.next_page_number }}">next</a>
                {% endif %}
            </span>
        </div>
    {% endif %}
{% else %}
<div class='alert alert-info'> No records</div>
{% endif %}
                
</div>
{% endblock %}

{% block lazy_javascript_code %}
    
<script src="{% static 'js/bootstrap-table.min.js' %}"></script>
<script src="{% static 'js/bootstrap-table-locale-all.min.js' %}"></script>
<script>

    function export_data(){
        var age = document.getElementById('age').value;
        var operator = document.getElementById('operator').value;
        var school_level = document.getElementById('school_level').value;    
        var hiv_status = document.getElementById('hiv_status').value;
        var art_status = document.getElementById('art_status').value;
        var url = "{% url 'data_cleanup' %}"+ '?export=True'+'&age='+age+
                  '&operator='+operator+'&school_level='+school_level+
                  '&hiv_status='+hiv_status+'&art_status='+art_status;
        window.location.href = url;
    }

    $(document).ready(function(){
      $('#age-data-table').bootstrapTable({ 
            toggle: 'table', 
            search: 'true',
            locale: 'en-US',
            pagination: 'true',
            pageNumber: 1,
            pageSize: 10,    
        });
    });
  </script>
{% endblock %}
